Here’s a concise overview of the tools wired into your DevSecOps pipeline and what each stage does.                  │
│                                                                                                                      │
│ Core CI/CD                                                                                                           │
│                                                                                                                      │
│  • Build Docker Image                                                                                                │
│     • Builds and tags your FastAPI app image: ${IMAGE_NAME}:${IMAGE_TAG} and latest.                                 │
│  • Run Tests                                                                                                         │
│     • Runs pytest inside the container (non-blocking if no tests).                                                   │
│  • Push to Docker Hub                                                                                                │
│     • Authenticates with Docker Hub and pushes both tags.                                                            │
│                                                                                                                      │
│ Security tools                                                                                                       │
│                                                                                                                      │
│  • Gitleaks (Secrets scanning)                                                                                       │
│     • Runs in a container against the workspace to detect hard-coded secrets.                                        │
│     • Output: reports/gitleaks-report.json                                                                           │
│     • Pipeline impact: Non-blocking; continues even if secrets are found.                                            │
│  • Semgrep (SAST)                                                                                                    │
│     • Runs in a container with the p/python ruleset against the source.                                              │
│     • Output: reports/semgrep-report.json                                                                            │
│     • Pipeline impact: Non-blocking.                                                                                 │
│  • Dependency-Check (SCA)                                                                                            │
│     • Scans dependencies for known CVEs (JSON and HTML outputs).                                                     │
│     • Output: reports/dependency-check-report.json, reports/dependency-check-report.html                             │
│     • Pipeline impact: Non-blocking.                                                                                 │
│  • Trivy (Container image scan)                                                                                      │
│     • Scans the built Docker image for OS and language-package vulnerabilities.                                      │
│     • Outputs:                                                                                                       │
│        • JSON: reports/trivy-report.json                                                                             │
│        • HTML: reports/trivy-report.html (via official Trivy HTML template)                                          │
│     • Pipeline impact: Non-blocking.                                                                                 │
│  • OWASP ZAP Baseline (DAST)                                                                                         │
│     • Scans a running endpoint (tries FastAPI on 8000; falls back to nginx on 8001).                                 │
│     • Outputs: reports/zap-report.json, reports/zap-report.html                                                      │
│     • Pipeline impact: Non-blocking.                                                                                 │
│                                                                                                                      │
│ AI/processing stages                                                                                                 │
│                                                                                                                      │
│  • Normalize Reports                                                                                                 │
│     • Runs a Python script to merge scan outputs into a unified schema.                                              │
│     • Uses reports/process_vulnerabilities.py in a Python container.                                                 │
│     • Output: processed/normalized_vulnerabilities.json                                                              │
│  • AI Security Policy Generation (DeepSeek R1 via Hugging Face)                                                      │
│     • Calls real_llm_integration.py to analyze normalized findings using DeepSeek R1 (Hugging Face Inference API).   │
│     • Output: ai-policies/llm_generated_policy.json                                                                  │
│     • Reads Hugging Face token via Jenkins credentials (HF_TOKEN) if configured; otherwise skips.                    │
│                                                                                                                      │
│ Observability                                                                                                        │
│                                                                                                                      │
│  • Archive Reports                                                                                                   │
│     • Archives all reports (.json, .html), processed/.json, ai-policies/.json as build artifacts.                    │
│  • Grafana Notification                                                                                              │
│     • Sends an annotation to Grafana with build and security context (optional; requires network/credentials).       │
│                                                                                                                      │
│ Behavior and design                                                                                                  │
│                                                                                                                      │
│  • Non-blocking security: The pipeline never fails on findings. Every tool produces real artifacts (no echo-only     │
│    placeholders).                                                                                                    │
│  • Artifacts location: All under reports/, processed/, ai-policies/ and archived in Jenkins.                         │
│  • CI friendly: You can examine artifacts post-run and share AI recommendations with the team.                       │
│                                                                                                                      │
│ Current notes and known adjustments                                                                                  │
│                                                                                                                      │
│  • Semgrep: Now correctly runs via semgrep scan entrypoint.                                                          │
│  • Dependency-Check: Fixed invalid format flag (now -f JSON -f HTML).                                                │
│  • Trivy HTML: Fixed by mounting Docker socket to access local image.                                                │
│  • Normalize Reports: Wired to the right script path.                                                                │
│  • AI stage: Runs inside ai-security-processor image to ensure Python deps; replaced jq with Python for robustness.  │
│  • ZAP: Image pull failed once (likely registry issue). Consider using owasp/zap2docker-weekly and/or docker login   │
│    beforehand.                                                                                                       │
│  • SonarQube: Failing due to no server at localhost:9000. Disable or point to a live SonarQube instance to use that  │
│    stage.                                                                                                            │
│  • DAST health loop: POSIX-safe retry and/or rely on nginx fallback to keep it robust.                               │
│                                                                                                                      │
│ Want me to:                                                                                                          │
│                                                                                                                      │
│  • Create a short Confluence page documenting this pipeline and where to find artifacts                              │
│  • Open a PR to finalize the remaining tweaks (ZAP tag, DAST loop, optional Sonar disable)                           │
│  • Add a .semgrep.yml and gitleaks.toml to stabilize results                                                         │
│  • Or trigger a run and review the generated AI recommendations together?                                            │
╰────────────────────────────────────────